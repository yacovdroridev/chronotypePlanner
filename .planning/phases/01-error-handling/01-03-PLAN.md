---
phase: 01-error-handling
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/usePlanner.js
  - src/components/screens/ResultScreen.jsx
autonomous: true

must_haves:
  truths:
    - "AI planning errors appear inline in Hebrew (not alert popup)"
    - "Plan save success/failure appears inline (not alert popup)"
    - "Plan load errors appear inline (not alert popup)"
    - "Task add validation appears inline (not alert popup)"
    - "Copy to clipboard shows inline feedback (not alert popup)"
  artifacts:
    - path: "src/hooks/usePlanner.js"
      provides: "Planner hook with error state"
      contains: "error, setError"
    - path: "src/components/screens/ResultScreen.jsx"
      provides: "Result screen with inline error display"
      contains: "error && ("
  key_links:
    - from: "usePlanner"
      to: "ResultScreen"
      via: "error returned from hook"
      pattern: "const.*error.*usePlanner"
---

<objective>
Replace all alert() calls in usePlanner and ResultScreen with inline Hebrew messages

Purpose: AI planning errors, save/load feedback, and task operations display inline instead of blocking alert() popups, improving UX.
Output: usePlanner returns error state; ResultScreen displays errors inline; zero alert() calls in both files
</objective>

<execution_context>
@/home/yacov/.claude/get-shit-done/workflows/execute-plan.md
@/home/yacov/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-error-handling/01-RESEARCH.md
@src/hooks/usePlanner.js
@src/components/screens/ResultScreen.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add error state to usePlanner hook</name>
  <files>src/hooks/usePlanner.js</files>
  <action>
1. Add error state (after planHtml and loading states):
   ```javascript
   const [error, setError] = useState(null);
   ```

2. Add success state for save/load feedback:
   ```javascript
   const [success, setSuccess] = useState(null);
   ```

3. In generateSchedule function:
   a. Clear error/success at start:
      ```javascript
      setError(null);
      setSuccess(null);
      ```

   b. Replace empty tasks alert (line ~20):
      - Before: `alert('No incomplete tasks to plan!');`
      - After: `setError('××™×Ÿ ××©×™××•×ª ×œ×ª×›× ×•×Ÿ. ×”×•×¡×£ ××©×™××•×ª ×§×•×“×.');`
      - Keep the `setLoading(false); return;`

   c. Replace catch block alert (line ~70):
      - Before: `alert('×©×’×™××” ×‘×™×¦×™×¨×ª ×ª×•×›× ×™×ª: ' + (error.message || 'Unknown Error'));`
      - After: `setError('×©×’×™××” ×‘×™×¦×™×¨×ª ×ª×•×›× ×™×ª: ' + (error.message || '×©×’×™××” ×œ× ×™×“×•×¢×”'));`

4. In savePlan function:
   a. Clear states at start:
      ```javascript
      setError(null);
      setSuccess(null);
      ```

   b. Replace error alert (line ~82):
      - Before: `if (error) alert('Error saving plan');`
      - After: `if (error) { setError('×©×’×™××” ×‘×©××™×¨×ª ×”×ª×•×›× ×™×ª'); return; }`

   c. Replace success alert (line ~83):
      - Before: `else alert('Plan saved!');`
      - After: `setSuccess('×”×ª×•×›× ×™×ª × ×©××¨×” ×‘×”×¦×œ×—×”!');`

5. In loadLastPlan function:
   a. Clear states at start:
      ```javascript
      setError(null);
      setSuccess(null);
      ```

   b. Replace no plans alert (line ~99):
      - Before: `alert('No saved plans found.');`
      - After: `setError('×œ× × ××¦××• ×ª×•×›× ×™×•×ª ×©××•×¨×•×ª');`

6. Add clearMessages helper:
   ```javascript
   const clearMessages = () => {
     setError(null);
     setSuccess(null);
   };
   ```

7. Update return statement to include error and success:
   ```javascript
   return {
     planHtml,
     loading,
     error,
     success,
     generateSchedule,
     savePlan,
     loadLastPlan,
     clearPlan: () => { setPlanHtml(''); clearMessages(); },
     clearMessages
   };
   ```
  </action>
  <verify>
1. `grep -c "alert(" src/hooks/usePlanner.js` returns 0
2. `grep -c "setError" src/hooks/usePlanner.js` returns at least 3
3. `grep -q "error, success" src/hooks/usePlanner.js` or `grep -q "error," src/hooks/usePlanner.js` returns success
4. File has no syntax errors: `node --check src/hooks/usePlanner.js` (may fail due to JSX, use npm start instead)
  </verify>
  <done>
- error and success states added to usePlanner
- All 5 alert() calls replaced with setError/setSuccess
- States cleared at start of each async operation
- error and success returned from hook
- clearMessages helper added
- Zero alert() calls remain in usePlanner.js
  </done>
</task>

<task type="auto">
  <name>Task 2: Display planner errors and success inline in ResultScreen</name>
  <files>src/components/screens/ResultScreen.jsx</files>
  <action>
1. Update usePlanner destructuring to include error and success:
   ```javascript
   const { planHtml, loading: planLoading, error: planError, success: planSuccess, generateSchedule, savePlan, loadLastPlan, clearPlan, clearMessages } = usePlanner();
   ```

2. Add local error state for task operations:
   ```javascript
   const [taskError, setTaskError] = useState(null);
   const [copySuccess, setCopySuccess] = useState(false);
   ```

3. Replace alert in handleAddTask (line ~13):
   - Before: `if (!newTask.description) return alert('Description required');`
   - After:
     ```javascript
     if (!newTask.description) {
       setTaskError('× × ×œ×”×–×™×Ÿ ×ª×™××•×¨ ××©×™××”');
       return;
     }
     setTaskError(null);
     ```

4. Replace copy alert (line ~121):
   - Before: `onClick={() => { navigator.clipboard.writeText(planHtml); alert('×”×•×¢×ª×§!'); }}`
   - After:
     ```javascript
     onClick={() => {
       navigator.clipboard.writeText(planHtml);
       setCopySuccess(true);
       setTimeout(() => setCopySuccess(false), 2000);
     }}
     ```

5. Add inline error/success display after the "AI Generator" section title, before the buttons:
   ```jsx
   {/* Error and Success Messages */}
   {planError && (
     <div dir="rtl" className="bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded text-sm mb-2" role="alert">
       {planError}
     </div>
   )}
   {planSuccess && (
     <div dir="rtl" className="bg-green-50 border border-green-200 text-green-700 px-3 py-2 rounded text-sm mb-2" role="status">
       {planSuccess}
     </div>
   )}
   ```

6. Add task error display after the "Add task" form section:
   ```jsx
   {taskError && (
     <div dir="rtl" className="bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded text-sm mb-2" role="alert">
       {taskError}
     </div>
   )}
   ```

7. Update copy button to show success state:
   ```jsx
   <button
     onClick={() => {
       navigator.clipboard.writeText(planHtml);
       setCopySuccess(true);
       setTimeout(() => setCopySuccess(false), 2000);
     }}
     className={`text-xs px-2 py-1 rounded ${copySuccess ? 'bg-green-500' : 'bg-blue-500'} text-white hover:opacity-80`}
   >
     {copySuccess ? '×”×•×¢×ª×§! âœ“' : '×”×¢×ª×§ ğŸ“‹'}
   </button>
   ```

8. Add useState import if not already present (it should be):
   ```javascript
   import React, { useState } from 'react';
   ```
  </action>
  <verify>
1. `grep -c "alert(" src/components/screens/ResultScreen.jsx` returns 0
2. `grep -q "planError" src/components/screens/ResultScreen.jsx` returns success
3. `grep -q "planSuccess" src/components/screens/ResultScreen.jsx` returns success
4. `npm start` - app loads, ResultScreen renders
5. Manual test: Click "Save" button, see inline success message (not popup)
  </verify>
  <done>
- planError and planSuccess from hook displayed inline
- taskError state added for task validation
- copySuccess state added for clipboard feedback
- All alert() calls removed from ResultScreen
- Error displays have RTL support and role="alert"
- Success displays have role="status"
- Zero alert() calls remain in ResultScreen.jsx
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify all planner error scenarios</name>
  <files>src/hooks/usePlanner.js, src/components/screens/ResultScreen.jsx</files>
  <action>
Test each error/success scenario:

1. **Empty task list:**
   - Delete all tasks (or ensure none exist)
   - Click any AI generate button (Today/Tomorrow/Week)
   - Verify: "××™×Ÿ ××©×™××•×ª ×œ×ª×›× ×•×Ÿ. ×”×•×¡×£ ××©×™××•×ª ×§×•×“×." appears inline (not popup)

2. **Task validation:**
   - Click "Add" to show form
   - Leave description empty
   - Click "×©××•×¨ ××©×™××”"
   - Verify: "× × ×œ×”×–×™×Ÿ ×ª×™××•×¨ ××©×™××”" appears inline (not popup)

3. **Save plan success:**
   - Generate a plan (have tasks, click Today)
   - Click "×©××•×¨" button
   - Verify: "×”×ª×•×›× ×™×ª × ×©××¨×” ×‘×”×¦×œ×—×”!" appears inline (not popup)

4. **Load no plans:**
   - If no saved plans exist (or use a new user)
   - Click "×˜×¢×Ÿ ×ª×•×›× ×™×ª ××—×¨×•× ×”"
   - Verify: "×œ× × ××¦××• ×ª×•×›× ×™×•×ª ×©××•×¨×•×ª" appears inline (not popup)

5. **Copy success:**
   - Generate a plan
   - Click "×”×¢×ª×§"
   - Verify: Button changes to "×”×•×¢×ª×§! âœ“" temporarily (not popup)

6. Final verification - ZERO alerts in both files:
   ```bash
   grep -n "alert(" src/hooks/usePlanner.js src/components/screens/ResultScreen.jsx
   ```
   This should return nothing.
  </action>
  <verify>
1. Empty tasks shows inline error
2. Empty task description shows inline error
3. Save shows inline success
4. Load with no plans shows inline error
5. Copy shows button state change
6. `grep -c "alert(" src/hooks/usePlanner.js src/components/screens/ResultScreen.jsx` returns 0 for both
7. App runs without console errors
  </verify>
  <done>
- All planner error scenarios display inline Hebrew messages
- All success scenarios display inline Hebrew messages
- No alert() popups in any planner/task flow
- REQ-003 verified for usePlanner and ResultScreen: inline feedback works
  </done>
</task>

</tasks>

<verification>
Run these checks to verify the plan succeeded:

```bash
# Zero alert() calls in both files
grep -c "alert(" src/hooks/usePlanner.js
# Expected: 0

grep -c "alert(" src/components/screens/ResultScreen.jsx
# Expected: 0

# Error state exists in hook
grep "error, success" src/hooks/usePlanner.js

# Error display exists in ResultScreen
grep "planError" src/components/screens/ResultScreen.jsx

# App runs
npm start
```

Manual verification:
1. With no tasks, click generate - inline error appears
2. Save a plan - inline success appears
3. Copy a plan - button shows success state
4. Add task with empty description - inline error appears
</verification>

<success_criteria>
- [x] error and success states added to usePlanner hook
- [x] usePlanner returns error and success to consumers
- [x] All 5 alert() calls in usePlanner replaced
- [x] planError and planSuccess displayed inline in ResultScreen
- [x] taskError state added for task validation
- [x] copySuccess state for clipboard feedback
- [x] All 2 alert() calls in ResultScreen replaced
- [x] All messages display in Hebrew with RTL support
- [x] Zero alert() calls remain in either file
</success_criteria>

<output>
After completion, create `.planning/phases/01-error-handling/01-03-SUMMARY.md`
</output>
