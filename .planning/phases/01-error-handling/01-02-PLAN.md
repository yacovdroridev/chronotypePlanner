---
phase: 01-error-handling
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/screens/LoginScreen.jsx
autonomous: true

must_haves:
  truths:
    - "Login validation errors appear inline in Hebrew (not alert popup)"
    - "Login/signup API errors appear inline in Hebrew (not alert popup)"
    - "OAuth errors appear inline in Hebrew (not alert popup)"
    - "Email verification message appears inline (not alert popup)"
  artifacts:
    - path: "src/components/screens/LoginScreen.jsx"
      provides: "Login form with inline error display"
      contains: "error && ("
  key_links:
    - from: "LoginScreen error state"
      to: "error JSX display"
      via: "conditional rendering"
      pattern: "\\{error && \\("
---

<objective>
Replace all alert() calls in LoginScreen with inline Hebrew error messages

Purpose: Login errors display gracefully inline instead of blocking alert() popups, improving UX and accessibility.
Output: LoginScreen.jsx with error state and inline error display, zero alert() calls
</objective>

<execution_context>
@/home/yacov/.claude/get-shit-done/workflows/execute-plan.md
@/home/yacov/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-error-handling/01-RESEARCH.md
@src/components/screens/LoginScreen.jsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add error state and inline error display</name>
  <files>src/components/screens/LoginScreen.jsx</files>
  <action>
1. Add error state to the component (after the existing useState declarations):
   ```javascript
   const [error, setError] = useState(null);
   ```

2. Replace ALL alert() calls with setError():

   a. Validation alert (line ~13):
      - Before: `alert('נא להזין שם, אימייל וסיסמה');`
      - After: `setError('נא להזין שם, אימייל וסיסמה');`

   b. Sign up error alert (line ~36):
      - Before: `alert(signUpError.message);`
      - After: `setError(signUpError.message);`

   c. Email verification alert (line ~42):
      - Before: `alert('נשלחה הודעת אימות לאימייל. אנא אשר אותה כדי להתחבר.');`
      - After: `setError('נשלחה הודעת אימות לאימייל. אנא אשר אותה כדי להתחבר.');`
      - NOTE: This is informational, not an error, but inline is better than popup

   d. Catch block alert (line ~58):
      - Before: `alert(error.message);`
      - After: `setError(error.message);`

   e. OAuth error alert (line ~69):
      - Before: `if (error) alert(error.message);`
      - After: `if (error) setError(error.message);`

3. Clear error at the start of handleLogin (after e.preventDefault()):
   ```javascript
   setError(null);
   ```

4. Clear error at the start of loginWithProvider:
   ```javascript
   setError(null);
   ```

5. Add inline error display in the JSX, between the form inputs and submit button:
   ```jsx
   {error && (
     <div
       dir="rtl"
       className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm"
       role="alert"
     >
       {error}
     </div>
   )}
   ```

6. Final structure should look like:
   ```jsx
   <form onSubmit={handleLogin} className="space-y-3">
     <input ... name />
     <input ... email />
     <input ... password />

     {error && (
       <div dir="rtl" className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm" role="alert">
         {error}
       </div>
     )}

     <button type="submit" ...>
   </form>
   ```
  </action>
  <verify>
1. `grep -c "alert(" src/components/screens/LoginScreen.jsx` returns 0
2. `grep -c "setError" src/components/screens/LoginScreen.jsx` returns at least 5
3. `grep -q "error && (" src/components/screens/LoginScreen.jsx` returns success
4. `npm start` - app loads, login screen renders
5. Manual test: Submit empty form, see inline error message (not popup)
  </verify>
  <done>
- error state added with useState
- All 5 alert() calls replaced with setError()
- Error cleared at start of login operations
- Inline error display added with Hebrew RTL support
- role="alert" added for accessibility
- Zero alert() calls remain in LoginScreen.jsx
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify all login error scenarios</name>
  <files>src/components/screens/LoginScreen.jsx</files>
  <action>
Test each error scenario to verify inline display works:

1. **Empty form validation:**
   - Clear all fields
   - Click submit
   - Verify: "נא להזין שם, אימייל וסיסמה" appears inline (not popup)

2. **Invalid email format:**
   - Enter name: "Test"
   - Enter email: "notanemail"
   - Enter password: "password123"
   - Click submit
   - Verify: Supabase error appears inline (not popup)

3. **Error clears on retry:**
   - After seeing an error, fill valid fields
   - Click submit
   - Verify: Error message disappears during submit attempt

4. If any scenario still shows alert(), fix by replacing remaining alert() with setError().

5. Verify the final code has ZERO alert() calls:
   ```bash
   grep -n "alert(" src/components/screens/LoginScreen.jsx
   ```
   This should return nothing.
  </action>
  <verify>
1. Empty form shows inline error
2. Invalid credentials show inline error
3. Error clears when retrying
4. `grep -c "alert(" src/components/screens/LoginScreen.jsx` returns 0
5. App runs without console errors
  </verify>
  <done>
- All error scenarios display inline Hebrew messages
- No alert() popups in any login error flow
- Errors clear appropriately when user retries
- REQ-003 verified for LoginScreen: inline error display works
  </done>
</task>

</tasks>

<verification>
Run these checks to verify the plan succeeded:

```bash
# Zero alert() calls in LoginScreen
grep -c "alert(" src/components/screens/LoginScreen.jsx
# Expected: 0

# setError is used
grep -c "setError" src/components/screens/LoginScreen.jsx
# Expected: 5+

# Error display exists
grep "error && (" src/components/screens/LoginScreen.jsx
# Expected: shows the error display line

# App runs
npm start
```

Manual verification:
1. Submit empty login form - error appears inline, no popup
2. Submit invalid email - error appears inline, no popup
3. Error clears when you start typing/resubmitting
</verification>

<success_criteria>
- [x] error state added to LoginScreen component
- [x] All 5 alert() calls replaced with setError()
- [x] Inline error display added with RTL support
- [x] Error has role="alert" for accessibility
- [x] Errors display inline for all login scenarios
- [x] Zero alert() calls remain in LoginScreen.jsx
</success_criteria>

<output>
After completion, create `.planning/phases/01-error-handling/01-02-SUMMARY.md`
</output>
